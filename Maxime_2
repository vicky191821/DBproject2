-- ? PLAYER_VALIDATIONS ?? CURRENT_CLUB_ID ????
CREATE INDEX idx_current_club_id ON PLAYER_VALIDATIONS (CURRENT_CLUB_ID);

-- ? PLAYER_VALIDATIONS ?? PLAYER_ID ????
CREATE INDEX idx_player_id ON PLAYER_VALIDATIONS (PLAYER_ID);

-- ? PLAYERS ?? PLAYER_ID ????
CREATE INDEX idx_players_player_id ON PLAYERS (PLAYER_ID);

-- ? CLUBS ?? CLUB_ID ????
CREATE INDEX idx_clubs_club_id ON CLUBS (CLUB_ID);

-- ? CLUB_GAMES ?? CLUB_ID ????
CREATE INDEX idx_club_games_club_id ON CLUB_GAMES (CLUB_ID);

SELECT SUM(PV.MARKET_VALUE_IN_EUR)
FROM PLAYER_VALIDATIONS PV
JOIN PLAYERS P ON PV.PLAYER_ID = P.PLAYER_ID
JOIN CLUBS C ON PV.CURRENT_CLUB_ID = C.CLUB_ID
JOIN CLUB_GAMES CG ON CG.CLUB_ID = C.CLUB_ID
WHERE ABS(CG.OWN_GOALS - CG.OPPONENT_GOALS) > 3
      AND C.LAST_SEASON = '2022'
      AND P.FIRST_NAME = 'Maxime';
